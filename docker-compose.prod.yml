# TaskQuest â€” Unified Portainer Stack
# API + Web + Social in a single stack

version: '3.8'

services:
  api:
    image: ghcr.io/brenonaraujo/taskquest-api:latest
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.role == manager
      restart_policy:
        condition: on-failure
    ports:
      - "5174:3000"
    environment:
      - PORT=3000
      - APP_ENV=production
      - SQLITE_PATH=/data/taskquest.db
      - CORS_ORIGIN=*
      - JWT_SECRET=${JWT_SECRET}
    volumes:
      - taskquest_data:/data

  web:
    image: ghcr.io/brenonaraujo/taskquest-web:latest
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
    ports:
      - "5173:80"
    depends_on:
      - api

  native-app:
    image: ghcr.io/brenonaraujo/task-quest-social:latest
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
    ports:
      - "5175:5000"
    environment:
      - NODE_ENV=production
      - PORT=5000
      # Same stack = use service name directly as hostname
      - TASKQUEST_API_URL=http://api:3000
      - AI_INTEGRATIONS_OPENAI_API_KEY=${AI_INTEGRATIONS_OPENAI_API_KEY:-}
    depends_on:
      - api

volumes:
  taskquest_data:
